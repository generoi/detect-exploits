#!/usr/bin/env bats

load test_helpers

setup() {
  umask 022
  printf ' %.0s' {1..200} >| $dir/wp-content/whitespace.php
}

teardown() {
  rm -f $dir/wp-content/whitespace.php
}

@test "is able to scan for whitespaces" {
  run bash ./detect-exploits.sh --scan-whitespaces --web-group="$user_group" "$dir"
  printf '%b\n' "$output"
  [ "$status" -eq 1 ]
  [[ "$output" == *"$dir/wp-content/whitespace.php:1"* ]]
  [[ "$output" == *"1 alerts found"* ]]
}
