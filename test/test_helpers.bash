dir=test/wordpress
user_group="$(id -g -n $USER)"

forbidden_word=$dir/wp-content/foo.php
forbidden_filename=$dir/wp-content/_old.php
forbidden_eval=$dir/wp-content/eval.php
forbidden_eval2=$dir/wp-cron.php
long_whitespace=$dir/wp-content/whitespace.php
long_line=$dir/wp-content/line.php
forbidden_uploads=$dir/wp-content/uploads/foo.inc
forbidden_duplicate=$dir/wp-content/files_mf/wp-config.php
file_chown=$dir/wp-activate.php
file_chmod=$dir/wp-blog-header.php
dir_chmod=$dir/wp-admin
generated_file_chown=$dir/wp-content/uploads/foo.txt
generated_file_chmod=$dir/wp-content/uploads/bar.txt
generated_dir_chmod=$dir/wp-content/uploads
generated_htaccess=$dir/wp-content/uploads/.htaccess

setup() {
  mkdir -p $dir/wp-content/{uploads,files_mf}
  chmod 2775 $dir/wp-content/{uploads,files_mf}
  echo "r0nin" >| $forbidden_word
  chmod 644 $forbidden_word
  touch -f $forbidden_filename
  chmod 644 $forbidden_filename
  echo "eval (base64_decode('xxx'))" >| $forbidden_eval
  chmod 644 $forbidden_eval
  echo -e "eval (base64_decode('cron'))" >> $forbidden_eval2
  printf ' %.0s' {1..200} >| $long_whitespace
  chmod 644 $long_whitespace
  printf '=%.0s' {1..1000} >| $long_line
  chmod 644 $long_line
  touch -f $forbidden_uploads
  chmod 664 $forbidden_uploads
  touch -f $forbidden_duplicate
  chmod 664 $forbidden_duplicate
  #chown $file_chown
  chmod o+w $file_chmod
  chmod o+w $dir_chmod
  #chown $generated_file_chown
  touch -f $generated_file_chmod; chmod o+w $generated_file_chmod
  chmod o+w $generated_dir_chmod
  touch -f $generated_htaccess; chmod o+w $generated_htaccess
}

teardown() {
  rm -f $forbidden_word
  rm -f $forbidden_filename
  rm -f $forbidden_eval
  sed -i '$ d' $forbidden_eval2
  rm -f $long_whitespace
  rm -f $long_line
  rm -f $forbidden_uploads
  rm -f $forbidden_duplicate
  #chown $file_chown
  chmod o-w $file_chmod
  chmod o-w $dir_chmod
  #chown $generated_file_chown
  rm -f $generated_file_chmod
  chmod o-w $generated_dir_chmod
  rm -f $generated_htaccess
  rm -rf $dir/wp-content/{uploads,files_mf}
}
